local -a opts
local token="$(curl-api-var token)" url="$(curl-api-var url)" api_opts="$(curl-api-var opts)"
local cookie="$(curl-api-var cookie)"
if [[ -n $token ]]
then [[ -n $cookie ]] && opts+=( -b $cookie=$token ) || opts+=( -H "X-Forever-Authorization: $token" )
fi
[[ -n $url ]] || { warn "Need API URL (set in $(curl-api-file url))" ; return 1 }
if [[ $1 = /* ]] ; then
  opts+=( $url$1 )
  shift
fi
[[ -n $api_opts ]] && opts+=( ${=api_opts} )
curl-json $opts "$@"
