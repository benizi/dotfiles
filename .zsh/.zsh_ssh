FORCE=${SSH_FORCE:-false}
function ssh_find_add () {
	find ~/.ssh -maxdepth 1 -type f -name 'id_*' ! -name '*.pub' \
	| sort \
	| perl -l0pe '' \
	| env -u DISPLAY xargs -0 ssh-add
}
if $FORCE || [ "x$LOGNAME" = "xbhaskell" ] ; then
	if $FORCE || ! pgrep ssh-agent > /dev/null ; then
		if [ -r ~/ssh-script ] ; then
			. ~/ssh-script > /dev/null
		fi
		if ! [ -n "$SSH_AGENT_PID" ] || ! kill -0 $SSH_AGENT_PID 2>/dev/null ; then
			ssh-agent > ~/ssh-script
		fi
		. ~/ssh-script
		ssh-add -l | grep -vq no.identities || ssh_find_add
		return
	fi
fi
[ -f ~/ssh-script ] && . ~/ssh-script > /dev/null
