#!/bin/zsh
if (( $#argv )) ; then rev=$1 ; shift ; else rev=HEAD ; fi
rev=$(git rev-parse $rev)
git branch | grep -q '^\* master$' && onmaster=true || onmaster=false
merge_base=$(git merge-base $rev master)
[[ $rev = $merge_base ]] && merge_base=$(git rev-parse $merge_base\~1)
case $0:t in
	git-lm) sub=log ; rev_arg=$merge_base.. ;;
	git-dm) sub=diff ; rev_arg=$merge_base.. ;;
	*) echo $merge_base ; exit ;;
esac
cmd=( git $sub $rev_arg $argv )
exec $cmd
