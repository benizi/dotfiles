#!/usr/bin/env ruby
=begin

Really stupid CSV to Tab-Separated-Value converter

=end
ARGF.each do |f|
	orig = f.dup
	f.gsub!(/\r/,'')
	fields = []
	while f and not f.empty?
		case f
		when /^([^",]*)(?=,|$)/
			fields << $1
			f = f[($1.size + 1)..-1]
		when /^"((?:[^"\\])*)"(?=,|$)/
			fields << $1
			f = f[($1.size + 3)..-1]
		else
			abort "Couldn't parse: #{f}\nFrom: #{orig}"
		end
	end
	puts fields.join("\t")
end
