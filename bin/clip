#!/bin/sh

clip() { xclip -selection "$@" ; }
clipboard() { clip clipboard "$@" ; }
clipout() { clip clipboard -out ; }
trim() { printf '%s' "$(clipout)" | clipboard ; }

mode=input
raw=true

while test $# -gt 0
do
  arg=$1
  case "$arg" in
    (-o|-out) mode=output ;;
    (-O|-n) mode=output ; raw=false ;;
    (--) mode=cmdline ; shift ; break ;;
    (*) break ;;
  esac
  shift
done

case "$mode" in
  (input)
    clipboard
    trim
    clipout | clip primary
    ;;
  (cmdline)
    printf '%s' "$*" | clipboard
    ;;
esac

clipout
$raw || printf '\n'
