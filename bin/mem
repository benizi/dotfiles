#!/bin/sh
test -e /proc/meminfo || exit 0
awk '
{ stats[substr($1,1,length($1)-1)] = int($2/1024) }
END {
  ram_tot = stats["MemTotal"]
  tot = ram_tot + stats["SwapTotal"]
  ram_free = stats["MemFree"]
  free = ram_free + stats["SwapFree"]
  used = tot - free
  avail = stats["MemAvailable"]
  low = (ram_tot > 20000) ? (ram_free < 4000) : (free < 2000)
  warn = (low && avail < 1000)
  mark = warn ? "!!! " : ""
  print mark "mem:" avail "/" used "/" tot
}
' /proc/meminfo
