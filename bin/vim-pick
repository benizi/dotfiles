#!/bin/sh
set -e
if ! tty -s
then
  test -z "$_vim_pick_loop_detect_"
  _vim_pick_loop_detect_=1 exec ensure-in-term "$0" "$@"
fi
vim -r 2>&1 |
tr -d '\r' |
awk -v OFS=\\t -v user=${USER:-"$(id -nu)"} '
/file name:/ {
  file = $0
  sub(/^[^:]*: */, "", file)
  sub("^~" user "/", "~/", file)
}
/process ID:/ && /still running/ { print file, $3 }' |
fzf -x |
awk '{ print $NF }' |
while read pick
do x-activate $pick
done
