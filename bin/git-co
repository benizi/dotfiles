#!/bin/zsh
unset cloneit
# git co user/project
# -> git co gh:user/project
if (( $# == 1 )) && [[ $1 = [^/]*/[^/]* ]] && [[ $1 != [^:]*:[^:]* ]] ; then
  set -- gh:$1
fi
case $# in
  1|2)
    case $1 in
      *:*)
        revlike=${1%%:*}
        if [[ ! -e $1 ]] ; then
          rev=$(git rev-list --no-walk $revlike -- 2>/dev/null)
          [[ -z $rev ]] && cloneit=true
        fi
        ;;
    esac
    ;;
esac
if (( $+cloneit )) ; then
  echo "[$1] looks like a repo, so cloning." >&2
  [[ $1 = gh:* ]] && set -- -o gh "$@"
  git clone "$@"
else
  git checkout "$@"
fi
