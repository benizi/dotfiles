#!/usr/bin/env perl

sub git { exec { 'git' } git => @_ }
sub checkout { git 'checkout', @_ }
sub clone { git 'clone', @_ }

sub is_rev {
  system { 'git' } git => 'rev-list' => '--no-walk'
}

checkout @ARGV if @ARGV > 2;
die "Usage: git $0 repo [dest]\n" unless @ARGV;

my ($repo, $dest) = @ARGV;
if ($repo =~ /\A(?:[a-z]+:)?(\w+\/\w+)\Z/) {
  $repo =~ s/^(?![a-z]+:)/gh:/;
  my @args = $repo;
  unshift @args, '-o', $repo =~ /^gh:/ ? 'gh' : 'upstream';
  push @args, grep $_, $dest;
  warn "[$ARGV[0]] looks like a repo, so cloning.\n";
  clone @args;
}

checkout @ARGV;
