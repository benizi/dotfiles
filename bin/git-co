#!/bin/zsh
unset cloneit
# git co user/project
# -> git co gh:user/project
if (( $# == 1 )) && [[ $1 = [^/]*/[^/]* ]] && [[ $1 != [^:]*:[^:]* ]] ; then
  set -- gh:$1
fi
case $# in
  1|2)
    case $1 in
      *:*)
        revlike=${1%%:*}
        rev=$(git rev-list --no-walk $revlike -- 2>/dev/null)
        # [[ -z $rev ]] && echo "[$revlike] not a revision" >&2
        [[ -z $rev ]] && cloneit=true
        ;;
    esac
    ;;
esac
if (( $+cloneit )) ; then
  echo "[$1] looks like a repo, so cloning." >&2
  git clone "$@"
  [[ $1 = gh:* ]] && { pushd *(/om[1]) ; git remote rename origin gh ; popd }
else
  git checkout "$@"
fi
