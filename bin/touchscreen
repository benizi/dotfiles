#!/bin/sh

# Find primary output, if it's connected
find_primary() {
  xrandr |
  awk '/ connected/ && !seen++ { if ($3 == "primary") print $1 }'
}

# Find Xinput IDs for touchscreens and pen tablets
find_graphics_tablets() {
  xinput list |
  awk -F'[\\t=]' '/Touchscreen|PenTablet/ && /pointer/ { print $3 }'
}

map_to_primary() {
  for tablet
  do xinput map-to-output $tablet $primary
  done
}

# Allow user to specify primary output as argument
parseargs() {
  if test $# -gt 0
  then : ${primary:=$1}
  else : ${primary:=$(find_primary)}
  fi
}

main() {
  # Allow user to specify primary output as environment variable
  test -n "$primary" || parseargs "$@"
  # Either primary is zero, or all graphics tablets should be mapped to it.
  test -z "$primary" || map_to_primary $(find_graphics_tablets)
}

main "$@"
