#!/usr/bin/env ruby
home = ENV['HOME'].dup
s_dir = File.join(home, 'screenshots')
drop = File.join(home, 'Dropbox', 'screenshots')

if !Dir.exists?(s_dir) and Dir.exists?(drop)
  File.symlink(drop, s_dir)
end

dir, template = Dir.exists?(s_dir) ? [s_dir, '%s'] : [home, 'screenshots-%s']
fullpath = File.join(dir, template)

filename = IO.popen('dmenu', 'r+') do |io|
  io.puts(Time.now.strftime('%Y-%m-%d-%H%M%S'))
  io.puts(Dir[fullpath % '*'].map { |f| File.basename(f, '.png') }.sort)
  io.close_write
  io.read.chomp
end
exit if filename.empty?
filename += '.png' unless filename =~ /\.\w+$/

system('import', fullpath % filename)
